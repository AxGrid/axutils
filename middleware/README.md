# axmiddleware

–ì–∏–±–∫–∞—è –∏ —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ –ü–û (middleware) –¥–ª—è Go-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –∏—Å–ø–æ–ª—å–∑—É—é—â–∞—è –¥–∂–µ–Ω–µ—Ä–∏–∫–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª—é–±—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîí –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ü–µ–ø–æ—á–∫–∏ middleware —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–∂–µ–Ω–µ—Ä–∏–∫–æ–≤
- üõ† –ü–∞—Ç—Ç–µ—Ä–Ω Builder –¥–ª—è —É–¥–æ–±–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- üìù –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ zerolog
- ‚ö° –ü–æ–¥–¥–µ—Ä–∂–∫–∞ context.Context
- üîÑ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —Ü–µ–ø–æ—á–∫–∏ middleware
- üèó –ì–æ—Ç–æ–≤—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö middleware
- üí™ –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–∞–Ω–∏–∫

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
go get github.com/yourusername/axmiddleware
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:

```go
package main

import (
    "context"
    "github.com/axgrid/axutils/axmiddleware"
    "github.com/rs/zerolog/log"
)

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø—ã –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ—Ç–≤–µ—Ç–∞
type Request struct {
    Data string
}

type Response struct {
    Result string
}

func main() {
    // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä —Å –Ω—É–∂–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏
    processor := axmiddleware.NewProcessor[Request, Response]().
        WithLogger(log.Logger).
        WithMiddlewares(
            axmiddleware.CatchPanicMiddlewares[Request, Response],
            axmiddleware.LogRequestResponseMiddlewares[Request, Response],
        ).
        WithHandlers(yourHandler).
        Build()

    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–ø—Ä–æ—Å
    request := Request{Data: "—Ç–µ—Å—Ç"}
    response := Response{}
    
    statusCode, err := processor.Process(context.Background(), request, &response)
    if err != nil {
        log.Error().Err(err).Msg("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏")
    }
}

func yourHandler(c *axmiddleware.Context[Request, Response]) {
    // –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
    req := c.Request()
    c.Response().Result = "–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: " + req.Data
}
```

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### Context

–¢–∏–ø `Context[R, S]` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏, –≤–∫–ª—é—á–∞—é—â–∏–π:
- –î–æ—Å—Ç—É–ø –∫ –∑–∞–ø—Ä–æ—Å—É –∏ –æ—Ç–≤–µ—Ç—É
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞–º–∏ —Å—Ç–∞—Ç—É—Å–∞
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ø–æ—á–∫–æ–π (–ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ, –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ)

### –¶–µ–ø–æ—á–∫–∞ Middleware

Middleware –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –ø–æ—Ä—è–¥–∫–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è. –ö–∞–∂–¥—ã–π middleware –º–æ–∂–µ—Ç:
- –ü–æ–ª—É—á–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∑–∞–ø—Ä–æ—Å—É –∏ –æ—Ç–≤–µ—Ç—É
- –ò–∑–º–µ–Ω—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç
- –£–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ—Ç–æ–∫–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∫–æ–¥—ã —Å—Ç–∞—Ç—É—Å–∞

### –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ Middleware

1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞–Ω–∏–∫**
```go
axmiddleware.CatchPanicMiddlewares[R, S]
```
–ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –ø–∞–Ω–∏–∫–∏ –≤ —Ü–µ–ø–æ—á–∫–µ middleware –∏ –ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏.

2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤**
```go
axmiddleware.LogRequestResponseMiddlewares[R, S]
```
–õ–æ–≥–∏—Ä—É–µ—Ç –¥–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤, –≤–∫–ª—é—á–∞—è –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

## –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ Middleware

```go
func –í–∞—àCustomMiddleware[R, S any](ctx *axmiddleware.Context[R, S]) {
    // –ü—Ä–µ–¥-–æ–±—Ä–∞–±–æ—Ç–∫–∞
    ctx.Logger().Info().Msg("–î–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏")
    
    ctx.Next() // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É middleware
    
    // –ü–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞
    ctx.Logger().Info().Msg("–ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏")
}
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```go
func –ú–∏–¥–ª–≤–∞—Ä–û–±—Ä–∞–±–æ—Ç–∫–∏–û—à–∏–±–æ–∫[R, S any](ctx *axmiddleware.Context[R, S]) {
    if –ø—Ä–æ–≤–µ—Ä–∫–∞–£—Å–ª–æ–≤–∏—è {
        ctx.AbortWithErrorAndCode(400, errors.New("–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å"))
        return
    }
    ctx.Next()
}
```

### –†–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

```go
func –ú–∏–¥–ª–≤–∞—Ä–û–±–æ–≥–∞—â–µ–Ω–∏—è–ö–æ–Ω—Ç–µ–∫—Å—Ç–∞[R, S any](ctx *axmiddleware.Context[R, S]) {
    ctx.WithValue("–∫–ª—é—á", "–∑–Ω–∞—á–µ–Ω–∏–µ")
    ctx.Next()
    
    // –î–æ—Å—Ç—É–ø –∫ –∑–Ω–∞—á–µ–Ω–∏—é –≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö middleware
    –∑–Ω–∞—á–µ–Ω–∏–µ := ctx.MustStringValue("–∫–ª—é—á")
}
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

1. **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
    - –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏ –æ—Ç–≤–µ—Ç–∞–º–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
    - –ò—Å–∫–ª—é—á–µ–Ω—ã –æ—à–∏–±–∫–∏ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
    - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –±–ª–∞–≥–æ–¥–∞—Ä—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –¥–∂–µ–Ω–µ—Ä–∏–∫–æ–≤
    - –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ü–µ–ø–æ—á–∫–∏ middleware

3. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**
    - –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ middleware
    - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö middleware
    - –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## –õ–∏—Ü–µ–Ω–∑–∏—è

[–£–∫–∞–∂–∏—Ç–µ –≤–∞—à—É –ª–∏—Ü–µ–Ω–∑–∏—é]

## –£—á–∞—Å—Ç–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

–ú—ã –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º –≤–∞—à–µ —É—á–∞—Å—Ç–∏–µ –≤ —Ä–∞–∑–≤–∏—Ç–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞! –°–æ–∑–¥–∞–≤–∞–π—Ç–µ issue –∏ –ø—Ä–∏—Å—ã–ª–∞–π—Ç–µ pull request'—ã.